<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Cashflow â€” Add Entry (Pro)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script type="module" src="js/theme.js" defer></script>
  <script type="module" src="js/add.js" defer></script>
  <script type="module" src="js/auth-guard.js" defer></script>
</head>

<body>
  <div class="container">

    <div class="header">
      <div>
        <h1>ðŸ’¸ Cashflow â€” Add Entry (Pro)</h1>
        <small>Quickly record money in/out with receipts, templates and suggestions</small>
      </div>

      <nav class="nav">
        <a href="index.html" class="ghost">Dashboard</a>
        <a href="add.html">Add Entry</a>
        <a href="entries.html" class="ghost">Entries</a>
      </nav>
    </div>

    <section class="panel pro-form">
      <div class="pro-form-grid">

        <form id="entryForm" class="pro-form-main" autocomplete="off">

          <div class="flex gap-4" style="flex-wrap: wrap;">
            <label style="flex: 1;">
              <span>Date</span>
              <input type="date" id="date" required />
            </label>

            <label style="flex: 1;">
              <span>Flow</span>
              <select id="flow" required>
                <option value="IN">IN (Money In)</option>
                <option value="OUT">OUT (Money Out)</option>
              </select>
            </label>

            <label style="flex: 1;">
              <span>Amount (â‚¹)</span>
              <input type="number" id="amount" step="0.01" min="0.01" placeholder="0.00" required />
              <small id="amountWords" class="muted"
                style="font-size: 0.75rem; margin-top: 4px; display: block;"></small>
            </label>
          </div>

          <div class="flex gap-4" style="flex-wrap: wrap;">
            <label style="flex:1">
              <span>Person</span>
              <input list="persons" id="person" placeholder="e.g., Rahul Sharma" />
              <datalist id="persons"></datalist>
            </label>

            <label style="flex:1">
              <span>Party</span>
              <input list="parties" id="party" placeholder="e.g., ABC Traders / Mr. Verma" />
              <datalist id="parties"></datalist>
            </label>

            <label style="flex:1">
              <span>Mode</span>
              <select id="mode">
                <option value="Cash">Cash</option>
                <option value="Online">Online</option>
              </select>
            </label>
          </div>

          <div class="flex gap-4" style="flex-wrap: wrap;">
            <label style="flex:1.5">
              <span>Type / Category</span>
              <input list="categories" id="category" placeholder="Select or type category" />
              <datalist id="categories"></datalist>
            </label>

            <label style="flex:1">
              <span>Receipt (optional)</span>
              <input type="file" id="receipt" accept="image/*,.pdf" />
              <small class="muted" style="font-size: 0.75rem;">Upload JPG/PNG or PDF. Max 5MB.</small>
            </label>

            <label style="flex:1">
              <span>Attach Preview</span>
              <div id="receiptPreview" class="receipt-preview">No file chosen</div>
            </label>
          </div>

          <!-- New field: Firm Name. It appears only when mode === 'Online' -->
          <label id="firmWrapper" style="display:none;">
            <span>Firm Name</span>
            <select id="firm">
              <option value="">-- Select firm --</option>
              <option value="Moonsky">Moonsky</option>
              <option value="Jindal">Jindal</option>
            </select>
            <small class="muted" style="font-size: 0.75rem;">Shown only when Mode = Online</small>
          </label>

          <label>
            <span>Remarks</span>
            <input type="text" id="remarks" placeholder="Optional remarks" />
          </label>

          <div class="flex items-center gap-4 mt-4" style="flex-wrap: wrap;">
            <div class="flex gap-2 items-center">
              <button type="submit" id="saveBtn">Save Entry</button>
              <button type="button" id="saveTemplate" class="ghost">Save as Template</button>
              <button type="button" id="clearDraft" class="ghost">Clear Draft</button>
            </div>

            <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
              <small class="muted">Shortcuts: <kbd
                  style="background: var(--hover-bg); padding: 2px 6px; border-radius: 4px; border: 1px solid var(--border);">Ctrl+Enter</kbd>
                save Â· <kbd
                  style="background: var(--hover-bg); padding: 2px 6px; border-radius: 4px; border: 1px solid var(--border);">Esc</kbd>
                clear</small>
            </div>
          </div>

        </form>

        <aside class="pro-side">
          <div class="panel" style="padding: 16px;">
            <h4 style="margin-top: 0;">Recent Templates</h4>
            <div id="templatesList" class="templates-list flex flex-col gap-2">No templates</div>
          </div>

          <div class="panel" style="padding: 16px; margin-top: 16px;">
            <h4 style="margin-top: 0;">Quick Info</h4>
            <p class="muted" style="font-size: 0.85rem;">Use templates to speed up repetitive entries. Uploaded receipts
              are stored in Supabase Storage and linked to the entry.</p>
            <p class="muted" style="font-size: 0.85rem;">Autosave preserves your draft locally.</p>
          </div>

        </aside>

      </div>
    </section>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>

  <!-- Loader -->
  <div class="app-loader" id="appLoader" aria-hidden="true">
    <div class="app-spinner" role="status" aria-label="Loading"></div>
  </div>
  <script type="module" src="js/loader.js" defer></script>
</body>

</html>